#!/usr/bin/env python3

import os
import subprocess
import random
import time

source = "{}/Pictures/Wallpaper".format(os.environ.get("HOME"))
target = "{}/.wallpaper".format(os.environ.get("HOME"))
walls = []


def get_wallpapers():
    r = [os.path.join(source, f) for f in os.listdir(source)]
    random.shuffle(r)
    return r


def set_wallpaper(wallpaper):
    
    first_time = not os.path.exists(target)
    
    if not walls:
        walls = get_wallpapers()

    subprocess.Popen("ln -sf '{}' {}".format(wallpaper, target), shell=True)

    if first_time:
        print(
            "This is the first time running wallpaperator, so we're creating "
            "a symlink at {} and telling GNOME to use it for "
            "wallpaper.".format(target)
        )
        subprocess.Popen("gsettings set {} picture-uri 'file://{}'".format(
            "org.gnome.desktop.background", target))


while True:
    set_wallpaper(walls.pop())
    time.sleep(60)

